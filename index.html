<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32 BME680 BLE Sensor</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #sensorData { font-size: 1.2em; margin: 20px 0; }
        button { font-size: 1em; padding: 10px 20px; }
    </style>
</head>
<body>
    <h1>ESP32 BME680 BLE Sensor</h1>
    <button id="connectButton">Connect to ESP32</button>
    <div id="sensorData">
        <p>Temperature: -- °C</p>
        <p>Pressure: -- hPa</p>
        <p>Humidity: -- %</p>
        <p>Gas: -- KOhms</p>
    </div>

    <script>
        const serviceUUID = "4fafc201-1fb5-459e-8fcc-c5c9c331914b";
        const characteristicUUID = "beb5483e-36e1-4688-b7f5-ea07361b26a8";
        let device, characteristic;

        document.getElementById('connectButton').addEventListener('click', connectToDevice);

        async function connectToDevice() {
            try {
                device = await navigator.bluetooth.requestDevice({
                    filters: [{ services: [serviceUUID] }]
                });

                const server = await device.gatt.connect();
                const service = await server.getPrimaryService(serviceUUID);
                characteristic = await service.getCharacteristic(characteristicUUID);

                await characteristic.startNotifications();
                characteristic.addEventListener('characteristicvaluechanged', handleCharacteristicValueChanged);

                console.log('Connected to ESP32');
                document.getElementById('connectButton').textContent = 'Connected';
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function handleCharacteristicValueChanged(event) {
            const value = new TextDecoder().decode(event.target.value);
            const [temp, pressure, humidity, gas] = value.split(',');
            document.getElementById('sensorData').innerHTML = `
                <p>Temperature: ${temp} °C</p>
                <p>Pressure: ${pressure} hPa</p>
                <p>Humidity: ${humidity} %</p>
                <p>Gas: ${gas} KOhms</p>
            `;
        }
    </script>
</body>
</html>
