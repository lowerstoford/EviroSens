<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32 Sensor Hub</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .sensor-data { margin: 20px; padding: 10px; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <h1>ESP32 Sensor Hub</h1>
    <button id="connectButton">Connect to ESP32</button>
    
    <div class="sensor-data">
        <h2>BME680 Temperature</h2>
        <p id="temperatureData">--</p>
    </div>
    
    <div class="sensor-data">
        <h2>BH1750 Light Level</h2>
        <p id="lightData">--</p>
    </div>
    
    <div class="sensor-data">
        <h2>GY521 Orientation</h2>
        <p id="orientationData">--</p>
    </div>

    <script>
        const serviceUUID = '181a';
        const bme680CharUUID = '2a6e';
        const bh1750CharUUID = '2a77';
        const gy521CharUUID = '2a6d';

        let device, server, service;

        async function connectBLE() {
            try {
                device = await navigator.bluetooth.requestDevice({
                    filters: [{ services: [serviceUUID] }]
                });
                server = await device.gatt.connect();
                service = await server.getPrimaryService(serviceUUID);
                
                const bme680Char = await service.getCharacteristic(bme680CharUUID);
                const bh1750Char = await service.getCharacteristic(bh1750CharUUID);
                const gy521Char = await service.getCharacteristic(gy521CharUUID);

                bme680Char.addEventListener('characteristicvaluechanged', handleBME680Data);
                bh1750Char.addEventListener('characteristicvaluechanged', handleBH1750Data);
                gy521Char.addEventListener('characteristicvaluechanged', handleGY521Data);

                await bme680Char.startNotifications();
                await bh1750Char.startNotifications();
                await gy521Char.startNotifications();

                console.log('Connected to ESP32');
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function handleBME680Data(event) {
            const temperature = event.target.value.getFloat32(0, true).toFixed(2);
            document.getElementById('temperatureData').textContent = `${temperature}Â°C`;
        }

        function handleBH1750Data(event) {
            const lux = event.target.value.getFloat32(0, true).toFixed(2);
            document.getElementById('lightData').textContent = `${lux} lux`;
        }

        function handleGY521Data(event) {
            const decoder = new TextDecoder('utf-8');
            const data = decoder.decode(event.target.value);
            const [ax, ay, az] = data.split(',');
            document.getElementById('orientationData').textContent = `X: ${ax}, Y: ${ay}, Z: ${az}`;
        }

        document.getElementById('connectButton').addEventListener('click', connectBLE);
    </script>
</body>
</html>
